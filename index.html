<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crewgle | Searchmas</title>
    <style>
        :root { --bg: #0b111e; --red: #c51111; --blue: #225ee1; --visor: #83d5e6; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Arial', sans-serif; background: var(--bg); color: white; overflow: hidden; }

        /* Search UI */
        #home-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; transition: 0.5s; }
        .logo { font-size: 5rem; font-weight: bold; margin-bottom: 20px; text-shadow: 3px 3px 0px #000; }
        .search-box { width: 500px; padding: 15px 25px; border-radius: 30px; border: none; font-size: 1.2rem; outline: none; }
        
        /* Iframe */
        #results-frame { position: fixed; top: 0; left: 0; width: 100%; height: calc(100% - 100px); display: none; border: none; background: white; }

        /* The Mini-Game Layer */
        #game-overlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 1000; }
        #meeting-ui { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,0,0,0.8); flex-direction: column; align-items: center; justify-content: center; text-align: center; }

        /* Nav Crewmates */
        .nav { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 50px; box-sizing: border-box; z-index: 2000; }
        .crewmate { width: 60px; height: 80px; border: 4px solid #000; border-radius: 20px 20px 10px 10px; position: relative; cursor: pointer; }
        .red { background: var(--red); }
        .blue { background: var(--blue); }
        .visor { position: absolute; top: 15px; left: 10px; width: 40px; height: 20px; background: var(--visor); border: 3px solid #000; border-radius: 10px; }
    </style>
</head>
<body>

    <div id="home-screen">
        <div class="logo">Crewgle</div>
        <input type="text" id="searchInput" class="search-box" placeholder="Search or type /play..." autocomplete="off">
    </div>

    <iframe id="results-frame"></iframe>

    <div id="game-overlay">
        <canvas id="gameCanvas"></canvas>
        <div id="meeting-ui">
            <h1 style="font-size: 4rem;">EMERGENCY MEETING</h1>
            <p>No Imposters found in Searchmas today.</p>
            <button onclick="exitGame()" style="padding: 15px 30px; font-size: 1.2rem; cursor: pointer;">Back to Search</button>
        </div>
    </div>

    <div class="nav">
        <div class="crewmate red" onclick="goHome()">
            <div class="visor"></div>
        </div>
        <div class="crewmate blue">
            <div class="visor"></div>
        </div>
    </div>

    <script>
        const input = document.getElementById('searchInput');
        const home = document.getElementById('home-screen');
        const frame = document.getElementById('results-frame');
        const gameLayer = document.getElementById('game-overlay');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Logic to catch /play
        input.addEventListener('keypress', (e) => {
            if (e.key === "Enter") {
                const val = input.value.trim();
                if (val === "/play") {
                    startMiniGame();
                } else if (val !== "") {
                    loadBing(val);
                }
            }
        });

        function loadBing(q) {
            frame.src = `https://www.bing.com/search?q=${encodeURIComponent(q)}`;
            home.style.transform = "translateY(-100%)";
            setTimeout(() => {
                frame.style.display = "block";
                home.style.display = "none";
            }, 500);
        }

        function goHome() {
            gameLayer.style.display = "none";
            frame.style.display = "none";
            home.style.display = "flex";
            setTimeout(() => home.style.transform = "translateY(0)", 10);
            input.value = "";
        }

        // --- MINI GAME ENGINE ---
        let player = { x: 0, y: 0, speed: 5 };
        let keys = {};
        
        function startMiniGame() {
            gameLayer.style.display = "block";
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
            gameLoop();
        }

        window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

        function gameLoop() {
            if (gameLayer.style.display === "none") return;
            
            ctx.fillStyle = "#1e1e1e"; // Space background
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Table/Button
            ctx.fillStyle = "red";
            ctx.beginPath(); ctx.arc(canvas.width/2, canvas.height/2, 50, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "white"; ctx.fillText("EMERGENCY", canvas.width/2 - 30, canvas.height/2 + 5);

            // Movement
            if (keys['w']) player.y -= player.speed;
            if (keys['s']) player.y += player.speed;
            if (keys['a']) player.x -= player.speed;
            if (keys['d']) player.x += player.speed;

            // Draw Red Player
            ctx.fillStyle = "red";
            ctx.fillRect(player.x - 15, player.y - 20, 30, 40);
            ctx.fillStyle = "#83d5e6"; // Visor
            ctx.fillRect(player.x, player.y - 15, 15, 10);

            // Check for Button Press
            let dist = Math.hypot(player.x - canvas.width/2, player.y - canvas.height/2);
            if (dist < 60 && keys['e']) document.getElementById('meeting-ui').style.display = "flex";

            requestAnimationFrame(gameLoop);
        }

        function exitGame() {
            document.getElementById('meeting-ui').style.display = "none";
            goHome();
        }
    </script>
</body>
</html>
