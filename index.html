<!DOCTYPE html>
<html style="background: #000;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crewgle</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; padding: 0; 
            background: #000; color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh; width: 100vw; overflow: hidden;
        }

        /* Search UI */
        #search-ui {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; width: 100%; transition: transform 0.6s cubic-bezier(0.15, 0.85, 0.35, 1);
        }
        .logo { font-size: 4.5rem; font-weight: 900; letter-spacing: -2px; margin-bottom: 20px; color: #fff; }
        input { 
            width: 85%; max-width: 500px; padding: 18px 25px; 
            border-radius: 50px; border: none; font-size: 1.2rem; 
            outline: none; background: #fff; color: #000;
        }

        /* Game Layer */
        #game-layer { 
            display: none; position: fixed; inset: 0; z-index: 100; background: #000; 
        }
        canvas { display: block; }

        /* Mobile Joystick */
        #joy-base {
            position: fixed; bottom: 50px; left: 50px; width: 100px; height: 100px;
            background: rgba(255,255,255,0.1); border-radius: 50%; display: none; z-index: 200;
        }
        #joy-knob {
            position: absolute; top: 25px; left: 25px; width: 50px; height: 50px;
            background: rgba(255,255,255,0.4); border-radius: 50%;
        }
    </style>
</head>
<body>

    <div id="search-ui">
        <div class="logo">Crewgle</div>
        <input type="text" id="q" placeholder="Search like a Crewmate..." autocomplete="off">
    </div>

    <div id="game-layer">
        <canvas id="c"></canvas>
        <div id="joy-base"><div id="joy-knob"></div></div>
    </div>

    <script>
        const q = document.getElementById('q');
        const ui = document.getElementById('search-ui');
        const gl = document.getElementById('game-layer');
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        const joyBase = document.getElementById('joy-base');
        const joyKnob = document.getElementById('joy-knob');

        let player = { x: 200, y: 200, size: 20, speed: 5, color: '#c51111' };
        let moveX = 0, moveY = 0;
        let keys = {};
        let isMobile = 'ontouchstart' in window;

        // Command Listener
        q.addEventListener('keypress', (e) => {
            if (e.key === "Enter") {
                let val = q.value.toLowerCase().trim();
                if (val === "/play") {
                    ui.style.display = "none";
                    gl.style.display = "block";
                    if(isMobile) joyBase.style.display = "block";
                    start();
                } else if (val !== "") {
                    window.location.href = "https://www.bing.com/search?q=" + encodeURIComponent(val);
                }
            }
        });

        function start() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            requestAnimationFrame(loop);
        }

        // Controls
        window.onkeydown = (e) => keys[e.key.toLowerCase()] = true;
        window.onkeyup = (e) => keys[e.key.toLowerCase()] = false;

        if(isMobile) {
            joyBase.addEventListener('touchmove', (e) => {
                let touch = e.touches[0];
                let rect = joyBase.getBoundingClientRect();
                moveX = (touch.clientX - (rect.left + 50)) / 10;
                moveY = (touch.clientY - (rect.top + 50)) / 10;
                joyKnob.style.transform = `translate(${moveX * 2}px, ${moveY * 2}px)`;
            });
            joyBase.addEventListener('touchend', () => {
                moveX = 0; moveY = 0;
                joyKnob.style.transform = `translate(0,0)`;
            });
        }

        function loop() {
            // Draw Map
            ctx.fillStyle = "#000"; // Clear screen with black
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Ship Floor (Skeld style)
            ctx.fillStyle = "#3e444e";
            ctx.fillRect(100, 100, 400, 300); // Cafeteria
            ctx.fillRect(500, 200, 300, 100); // Hallway
            
            // Emergency Button Table
            ctx.fillStyle = "#2c313a";
            ctx.beginPath(); ctx.arc(300, 250, 60, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "#c51111";
            ctx.beginPath(); ctx.arc(300, 250, 20, 0, Math.PI*2); ctx.fill();

            // Player Movement
            if(!isMobile) {
                if(keys['w'] || keys['arrowup']) player.y -= player.speed;
                if(keys['s'] || keys['arrowdown']) player.y += player.speed;
                if(keys['a'] || keys['arrowleft']) player.x -= player.speed;
                if(keys['d'] || keys['arrowright']) player.x += player.speed;
            } else {
                player.x += moveX; player.y += moveY;
            }

            // Draw Character
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x - 15, player.y - 20, 30, 40); // Body
            ctx.fillStyle = "#83d5e6";
            ctx.fillRect(player.x, player.y - 15, 15, 10); // Visor

            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
