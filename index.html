<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crewgle | Searchmas</title>
    <style>
        :root { --space: #0b111e; --ship-floor: #3e444e; --wall: #2c313a; --red: #c51111; --visor: #83d5e6; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--space); color: white; overflow: hidden; font-family: sans-serif; }

        /* UI Overlay */
        #home-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; transition: 0.5s; }
        .search-box { width: 80%; max-width: 500px; padding: 15px; border-radius: 30px; border: none; outline: none; text-align: center; font-size: 1.2rem; }

        /* The Game */
        #game-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 1000; }
        canvas { display: block; width: 100%; height: 100%; }

        /* Joystick for Mobile */
        #joy { position: fixed; bottom: 50px; left: 50px; width: 100px; height: 100px; background: rgba(255,255,255,0.2); border-radius: 50%; display: none; touch-action: none; }
        #knob { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: #fff; border-radius: 50%; opacity: 0.5; }

        /* Nav */
        .nav { position: fixed; bottom: 10px; width: 100%; display: flex; justify-content: center; gap: 40px; pointer-events: none; }
        .crew { width: 30px; height: 40px; border: 2px solid #000; border-radius: 10px; position: relative; pointer-events: auto; cursor: pointer; }
        .visor-mini { position: absolute; top: 8px; right: -2px; width: 15px; height: 8px; background: var(--visor); border: 2px solid #000; border-radius: 5px; }

        #meeting { display: none; position: fixed; inset: 0; background: rgba(150,0,0,0.9); z-index: 2000; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="home-screen">
    <h1 style="font-size: 4rem;">Crewgle</h1>
    <input type="text" id="s" class="search-box" placeholder="Search like a Crewmate..." autocomplete="off">
</div>

<div id="game-overlay">
    <canvas id="c"></canvas>
    <div id="joy"><div id="knob"></div></div>
    <div id="meeting">
        <h1>EMERGENCY MEETING</h1>
        <button onclick="location.reload()" style="padding: 10px 20px;">Return to Ship</button>
    </div>
</div>

<div class="nav">
    <div class="crew" style="background:var(--red)" onclick="location.reload()"><div class="visor-mini"></div></div>
    <div class="crew" style="background:#225ee1"><div class="visor-mini"></div></div>
</div>

<script>
const input = document.getElementById('s');
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const joy = document.getElementById('joy');
const knob = document.getElementById('knob');

let player = { x: 200, y: 200, dx: 0, dy: 0, speed: 4 };
let keys = {};
let isMobile = 'ontouchstart' in window;

input.onkeypress = (e) => {
    if(e.key === "Enter") {
        if(input.value.toLowerCase() === "/play") {
            document.getElementById('game-overlay').style.display = "block";
            if(isMobile) joy.style.display = "block";
            initGame();
        } else {
            window.location.href = "https://www.bing.com/search?q=" + encodeURIComponent(input.value);
        }
    }
}

function initGame() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    loop();
}

window.onkeydown = (e) => keys[e.key] = true;
window.onkeyup = (e) => keys[e.key] = false;

// Mobile Joystick Logic
if(isMobile) {
    joy.ontouchmove = (e) => {
        let t = e.touches[0];
        let r = joy.getBoundingClientRect();
        player.dx = (t.clientX - (r.left + 50)) / 10;
        player.dy = (t.clientY - (r.top + 50)) / 10;
        knob.style.transform = `translate(${player.dx*2}px, ${player.dy*2}px)`;
    };
    joy.ontouchend = () => { player.dx = 0; player.dy = 0; knob.style.transform = "translate(0,0)"; };
}

function drawMap() {
    // Space Background (Fixes the White Screen)
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Ship Floor
    ctx.fillStyle = "#3e444e";
    // Cafeteria
    ctx.fillRect(100, 100, 400, 300);
    // Hallway
    ctx.fillRect(500, 200, 300, 100);
    // Nav Room
    ctx.fillRect(800, 150, 200, 200);

    // Emergency Button Table
    ctx.fillStyle = "#2c313a";
    ctx.beginPath(); ctx.arc(300, 250, 60, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = "red";
    ctx.beginPath(); ctx.arc(300, 250, 20, 0, Math.PI*2); ctx.fill();
}

function loop() {
    drawMap();

    // Movement PC
    if(!isMobile) {
        if(keys.ArrowUp || keys.w) player.y -= player.speed;
        if(keys.ArrowDown || keys.s) player.y += player.speed;
        if(keys.ArrowLeft || keys.a) player.x -= player.speed;
        if(keys.ArrowRight || keys.d) player.x += player.speed;
    } else {
        player.x += player.dx;
        player.y += player.dy;
    }

    // Draw Crewmate
    ctx.fillStyle = "red";
    ctx.fillRect(player.x - 15, player.y - 20, 30, 40);
    ctx.fillStyle = "#83d5e6";
    ctx.fillRect(player.x, player.y - 15, 15, 10);

    // Interaction
    let d = Math.hypot(player.x - 300, player.y - 250);
    if(d < 50) {
        ctx.fillStyle = "white";
        ctx.fillText("TAP SCREEN / PRESS E", 250, 180);
        if(keys.e) document.getElementById('meeting').style.display = "flex";
    }

    requestAnimationFrame(loop);
}

canvas.onclick = () => {
    let d = Math.hypot(player.x - 300, player.y - 250);
    if(d < 50) document.getElementById('meeting').style.display = "flex";
}
</script>
</body>
</html>
